# ğŸ“‹ ××¢×¨×›×ª 1: × ×™×”×•×œ ×¡×©× ×™× (Session Management)

---

## ğŸ¯ ××˜×¨×”
× ×™×”×•×œ ××—×–×•×¨ ×—×™×™× ××œ× ×©×œ ×—×™×‘×•×¨×™ WhatsApp - ×™×¦×™×¨×”, ×—×™×‘×•×¨, ×©××™×¨×”, ×©×—×–×•×¨, ×•××—×™×§×”.

---

## ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SESSION MANAGEMENT SYSTEM                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Dashboard  â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ Orchestrator â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚   Worker    â”‚  â”‚
â”‚  â”‚   (UI)       â”‚       â”‚   (API)      â”‚       â”‚  (Baileys)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                       â”‚         â”‚
â”‚                                â–¼                       â–¼         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                         â”‚    Redis     â”‚       â”‚  WhatsApp   â”‚  â”‚
â”‚                         â”‚  (State DB)  â”‚       â”‚  (Meta)     â”‚  â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                â”‚                                 â”‚
â”‚                                â–¼                                 â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                         â”‚   sessions/  â”‚                        â”‚
â”‚                         â”‚  (Auth Data) â”‚                        â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ×§×•××¤×•× × ×˜×•×ª

### 1. Redis Keys (××¦×‘ ×¡×©× ×™×)
```
session:<id>:status     = "pending" | "qr_ready" | "connected" | "disconnected" | "failed"
session:<id>:phone      = "972501234567"
session:<id>:proxy      = "socks5h://..."
session:<id>:qr         = "2@ABC..." (temporary)
session:<id>:lock       = "container_xyz" (×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª)
session:<id>:created    = 1702500000000
session:<id>:lastPing   = 1702500060000

phone:<number>:session  = "worker_1"
phone:<number>:proxy    = "socks5h://..." (Sticky IP)
```

### 2. ×§×‘×¦×™ Auth (sessions/)
```
sessions/
â”œâ”€â”€ worker_1/
â”‚   â”œâ”€â”€ creds.json          # ××¤×ª×—×•×ª ×”×¦×¤× ×”
â”‚   â”œâ”€â”€ app-state-sync-key-*.json
â”‚   â””â”€â”€ pre-key-*.json
â”œâ”€â”€ worker_2/
â”‚   â””â”€â”€ ...
â””â”€â”€ worker_3/
    â””â”€â”€ ...
```

### 3. Proxy Pool
```
proxy:<url>:status      = "active" | "bad" | "testing"
proxy:<url>:sessions    = 3 (×›××” ×¡×©× ×™× ××©×ª××©×™×)
proxy:<url>:lastError   = "timeout at 2024-01-01..."
```

---

## ğŸ”„ ×–×¨×™××•×ª

### Flow 1: ×™×¦×™×¨×ª ×¡×©×Ÿ ×—×“×©

```
[User] â”€â–º POST /api/sessions/provision
          { phone?: "972...", proxy?: "socks5h://..." }
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Validation                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚ â€¢ Check phone not already registered                        â”‚
â”‚ â€¢ Check proxy format (must be socks5h://)                   â”‚
â”‚ â€¢ Check proxy capacity (< 4 sessions)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Proxy Selection                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚ if (proxy provided) {                                       â”‚
â”‚   selectedProxy = proxy;                                    â”‚
â”‚ } else if (phone has sticky binding) {                      â”‚
â”‚   selectedProxy = redis.get(`phone:${phone}:proxy`);        â”‚
â”‚ } else {                                                    â”‚
â”‚   selectedProxy = selectFromPool(); // capacity < 4         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Create Session Record                               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚ sessionId = "worker_" + nextId();                           â”‚
â”‚                                                             â”‚
â”‚ redis.set(`session:${id}:status`, "pending");               â”‚
â”‚ redis.set(`session:${id}:proxy`, selectedProxy);            â”‚
â”‚ redis.set(`session:${id}:created`, Date.now());             â”‚
â”‚ redis.incr(`proxy:${selectedProxy}:sessions`);              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Start Worker Container                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚ docker run -d \                                             â”‚
â”‚   --name wa_session_${sessionId} \                          â”‚
â”‚   --network whatsapp-network \                              â”‚
â”‚   -v ./sessions/${sessionId}:/app/session \                 â”‚
â”‚   -e SESSION_ID=${sessionId} \                              â”‚
â”‚   -e PROXY_URL=${selectedProxy} \                           â”‚
â”‚   -e WEBHOOK_URL=http://orchestrator:3000/webhook \         â”‚
â”‚   worker-image                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         [Return sessionId]
```

### Flow 2: ×¡×¨×™×§×ª QR ×•×—×™×‘×•×¨

```
[Worker] â”€â–º Connects to WhatsApp via Proxy
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: QR Generated                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚ Worker â†’ Webhook:                                           â”‚
â”‚ {                                                           â”‚
â”‚   type: "QR_CODE",                                          â”‚
â”‚   sessionId: "worker_1",                                    â”‚
â”‚   data: { qr: "2@ABC123XYZ..." }                            â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ Orchestrator:                                               â”‚
â”‚ â€¢ redis.set(`session:worker_1:qr`, qr);                     â”‚
â”‚ â€¢ redis.set(`session:worker_1:status`, "qr_ready");         â”‚
â”‚ â€¢ websocket.broadcast({ event: "qr", sessionId, qr });      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
[User] â”€â–º Scans QR with Phone
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Connection Established                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚ Worker â†’ Webhook:                                           â”‚
â”‚ {                                                           â”‚
â”‚   type: "CONNECTED",                                        â”‚
â”‚   sessionId: "worker_1",                                    â”‚
â”‚   data: { phoneNumber: "972501234567" }                     â”‚
â”‚ }                                                           â”‚
â”‚                                                             â”‚
â”‚ Orchestrator:                                               â”‚
â”‚ â€¢ redis.set(`session:worker_1:status`, "connected");        â”‚
â”‚ â€¢ redis.set(`session:worker_1:phone`, phone);               â”‚
â”‚ â€¢ redis.del(`session:worker_1:qr`);                         â”‚
â”‚                                                             â”‚
â”‚ â€¢ // STICKY IP BINDING (×—×©×•×‘!)                              â”‚
â”‚ â€¢ redis.set(`phone:${phone}:proxy`, proxy);                 â”‚
â”‚ â€¢ redis.set(`phone:${phone}:session`, sessionId);           â”‚
â”‚                                                             â”‚
â”‚ â€¢ telegram.send("âœ… Session connected: " + phone);          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 3: Keep-Alive (×©××™×¨×ª ×—×™×‘×•×¨)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WORKER - Keep-Alive Engine                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚                                                             â”‚
â”‚ // Every 15 seconds - Presence Update                       â”‚
â”‚ setInterval(() => {                                         â”‚
â”‚   sock.sendPresenceUpdate('available');                     â”‚
â”‚   webhook('PING', { timestamp: Date.now() });               â”‚
â”‚ }, 15000);                                                  â”‚
â”‚                                                             â”‚
â”‚ // Every 10 minutes - Hidden Message to Self                â”‚
â”‚ setInterval(() => {                                         â”‚
â”‚   sock.sendMessage(myJid, { text: "ğŸ”„" }, {                 â”‚
â”‚     ephemeralExpiration: 86400  // disappears in 24h        â”‚
â”‚   });                                                       â”‚
â”‚ }, 600000);                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ORCHESTRATOR - Watchdog                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                             â”‚
â”‚ // Every 60 seconds - Check all sessions                    â”‚
â”‚ for (session of allSessions) {                              â”‚
â”‚   lastPing = redis.get(`session:${id}:lastPing`);           â”‚
â”‚                                                             â”‚
â”‚   if (Date.now() - lastPing > 180000) {  // 3 minutes       â”‚
â”‚     // Session unresponsive!                                â”‚
â”‚     markUnhealthy(session);                                 â”‚
â”‚     attemptRestart(session);                                â”‚
â”‚   }                                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 4: ×”×ª× ×ª×§×•×ª ×•-Reconnect

```
[WhatsApp] â”€â–º Disconnects Worker
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Worker Reports Disconnect                           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚ Worker â†’ Webhook:                                           â”‚
â”‚ {                                                           â”‚
â”‚   type: "DISCONNECTED",                                     â”‚
â”‚   sessionId: "worker_1",                                    â”‚
â”‚   data: {                                                   â”‚
â”‚     reason: "connection_lost",                              â”‚
â”‚     code: 515,                                              â”‚
â”‚     isProxyError: false                                     â”‚
â”‚   }                                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Orchestrator Handles                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                             â”‚
â”‚ if (isProxyError) {                                         â”‚
â”‚   // Switch to new proxy                                    â”‚
â”‚   proxyPool.markBad(currentProxy);                          â”‚
â”‚   newProxy = proxyPool.selectAvailable();                   â”‚
â”‚   restartWithNewProxy(sessionId, newProxy);                 â”‚
â”‚ } else if (isLoggedOut) {                                   â”‚
â”‚   // Need new QR scan                                       â”‚
â”‚   redis.set(`session:${id}:status`, "logged_out");          â”‚
â”‚   deleteAuthFiles(sessionId);                               â”‚
â”‚ } else {                                                    â”‚
â”‚   // Simple reconnect                                       â”‚
â”‚   redis.set(`session:${id}:status`, "reconnecting");        â”‚
â”‚   // Worker will auto-reconnect using saved auth            â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 5: ×’×™×‘×•×™ ×•×©×—×–×•×¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKUP (Daily CRON - 03:00 AM)                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚                                                             â”‚
â”‚ 1. Stop all workers temporarily                             â”‚
â”‚ 2. Create zip: sessions/ â†’ backups/backup_2024-01-01.zip    â”‚
â”‚ 3. Keep last 7 backups, delete older                        â”‚
â”‚ 4. Restart all workers                                      â”‚
â”‚ 5. Telegram: "âœ… Daily backup complete"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESTORE (Manual via API)                                    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                             â”‚
â”‚ POST /api/v1/backups/restore/:backupId                      â”‚
â”‚                                                             â”‚
â”‚ 1. Stop all workers                                         â”‚
â”‚ 2. Delete current sessions/                                 â”‚
â”‚ 3. Extract backup to sessions/                              â”‚
â”‚ 4. Rebuild Redis state from files                           â”‚
â”‚ 5. Restart all workers                                      â”‚
â”‚ 6. Telegram: "âœ… Restore complete"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ API Endpoints

| Method | Endpoint | ×ª×™××•×¨ |
|--------|----------|-------|
| POST | `/api/sessions/provision` | ×™×¦×™×¨×ª ×¡×©×Ÿ ×—×“×© |
| GET | `/api/sessions/:id/qr` | ×§×‘×œ×ª QR ×œ×¡×¨×™×§×” |
| GET | `/api/sessions/:id/status` | ×¡×˜×˜×•×¡ ×¡×©×Ÿ |
| DELETE | `/api/sessions/:id` | ××—×™×§×ª ×¡×©×Ÿ |
| POST | `/api/sessions/:id/restart` | ×”×¤×¢×œ×” ××—×“×© |
| GET | `/api/v1/dashboard/sessions` | ×¨×©×™××ª ×›×œ ×”×¡×©× ×™× |
| POST | `/api/v1/backups/create` | ×™×¦×™×¨×ª ×’×™×‘×•×™ |
| GET | `/api/v1/backups` | ×¨×©×™××ª ×’×™×‘×•×™×™× |
| POST | `/api/v1/backups/restore/:id` | ×©×—×–×•×¨ |

---

## ğŸ” ×—×•×§×™ Proxy

| ×—×•×§ | ×¢×¨×š | ×¡×™×‘×” |
|-----|-----|------|
| ×¤×•×¨××˜ | `socks5h://` | DNS ×“×¨×š ×”×¤×¨×•×§×¡×™ |
| ××§×¡×™××•× ×¡×©× ×™× | 4 ×œ×¤×¨×•×§×¡×™ | ×× ×™×¢×ª ×©×¨×™×¤×” |
| Sticky IP | Phone â†’ Proxy | ××•×ª×• IP ×ª××™×“ |
| Failover | ××•×˜×•××˜×™ | ×”×—×œ×¤×” ×‘×ª×§×œ×” |

---

## ğŸ“Š Webhook Events (Worker â†’ Orchestrator)

| Event | Data | ×ª×™××•×¨ |
|-------|------|-------|
| `QR_CODE` | `{qr}` | QR ××•×›×Ÿ |
| `CONNECTED` | `{phoneNumber}` | ×”×ª×—×‘×¨ |
| `DISCONNECTED` | `{reason, code}` | ×”×ª× ×ª×§ |
| `PING` | `{timestamp}` | Keep-alive |
| `PROXY_ERROR` | `{error}` | ×ª×§×œ×ª ×¤×¨×•×§×¡×™ |
| `AUTH_FAILURE` | `{reason}` | × ×“×¨×© QR ×—×“×© |

